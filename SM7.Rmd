---
title: "APA&Co project | Change in IPAQ MET-min/week between 0 and 12 months"
output: 
  html_document:
    theme: cosmo
    toc: yes
    toc_depth: 2
    toc_float: yes
    number_sections: yes
    df_print: paged
    code_folding: hide
toc-title: "Table of content"

---
```{css, echo=FALSE}
.title {
  font-weight: bold;
}


h1 {
  font-size: 25px;
  font-weight: bold;
}
h2 {
  font-size: 23px;
  font-weight: bold;
}
h3 {
  font-size: 21px;
}
p.caption {
  color: #777;
  margin-top: 10px;
}
p code {
  white-space: inherit;
}
pre {
  word-break: normal;
  word-wrap: normal;
}
pre code {
  white-space: inherit;
}
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
ggplot2::theme_set(ggplot2::theme_bw())
```


# Change in IPAQ MET-min/week between 0 and 12 months
## Descriptive statistics
```{r}
targets::tar_read(DB_IPAQ_0_12) |>
  dplyr::select(-n_visits) |>  
  dplyr::group_by(MONTH) |> 
  skimr::skim()
```

## Estimate of the median of the individual changes
```{r}
tar_read(change_IPAQ)$hd_pbci_diff |> 
  dplyr::filter(q == 0.5) |> 
  dplyr::mutate(dplyr::across(estimate:ci_u, ~round(.x, digits = 2)))
```

## Shift and difference asymmetry functions
```{r, fig.width=22, fig.height=16, fig.cap='Change in IPAQ-SF MET-min/week between 6 and 12 months (N = 77). On panel A, the errors bars over the points are the standard deviations around the means, while on panel D it is the percentile bootstrap 95% confidence interval around the median estimate. On panels E and F, the error bars are percentile bootstrap 95% confidence intervals non corrected for multiple comparisons. On panels B, C and D, the horizontal and/or vertical segments are the estimates of the deciles (panels B and C) or the quantiles (panel D, step of 0.05) of the distributions; the thickest segments are the median estimates. On panel B, the diagonal black line depicts the identity line. If any, significant results (based on adjusted p-values) in the shift (panel E) and difference asymmetry (panel F) functions are highlighted using thick red circles. A small pseudo-random movement has been added horizontally and vertically to the raw data displayed on panel B to minimize the presence of points fully overlapped. The estimates of the deciles of the marginal distributions (panels B, C and D), the quantiles of the individual differences (panel D), the decile differences (panel E) and the quantile sums (panel F) have been computed using the Harrell-Davis estimator.'}
targets::tar_read(change_IPAQ)$p
```

# Change in EMAPS scores between 0 and 12 months
## Descriptive statistics
```{r}
targets::tar_read(DB_EMAPS_0_12) |> 
  dplyr::select(-n_visits) |>  
  dplyr::group_by(MONTH) |> 
  skimr::skim()
```

## Estimates of the medians of the individual changes
```{r, results = "asis"}
targets::tar_load(change_EMAPS)
res <-
  purrr::map(change_EMAPS, function(x) {
  
  knitr::knit_child(text = c(
                    
                    "\n",
                    "### `r x$variable`",
                    "\n",
                    "```{r, echo = FALSE}",
                    "x$hd_pbci_diff |>  
                     dplyr::filter(q == 0.5) |> 
                     dplyr::mutate(dplyr::across(estimate:ci_u, ~round(.x, digits = 2)))",
                    "```"
  ),
  envir = environment(),
  quiet  = TRUE
  )
})

cat(unlist(res), sep = "\n")
```


# Barriers to physical activity at 12 months
```{r, fig.width=12, fig.height=8, fig.cap='Barriers to physical activity (N = 77). Answers have been translated from French to English for the readerâ€™s understanding of the figure. The most frequently evocated barriers have been highlighted with darker colours.'}
targets::tar_read(p_BARRIERS)
```


